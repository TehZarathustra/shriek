language: node_js

node_js:
  - "4.0.0"

branches:
  only:
    - master
    - develop

services:
  - mongodb

addons:
  ssh_known_hosts: 128.199.39.245

before_install:
  - openssl aes-256-cbc -K $encrypted_48afa7b4060f_key -iv $encrypted_48afa7b4060f_iv
    -in deploy_key.enc -out deploy_key -d

install:
  - npm install --production
  - npm run init

script:
  # test running

after_success:
  - chmod 600 deploy_key
  - mv deploy_key ~/.ssh/id_rsa

deploy:
  - provider: script
    script: ./scripts/deploy-production.sh
    on:
      branch: master

  - provider: script
    script: ./scripts/deploy-dev.sh
    on:
      branch: develop
